<div class="row">

  <div class="col-md-8 col-md-offset-2">

    <div class="panel panel-default">

      <div class="panel-heading">

        <h3 class="panel-title">
          Journey #<%= @journey.id %>
        </h3>

      </div>

      <div class="panel-body">
        <!-- Information about journey -->
        <dl class="dl-horizontal">
          <dt>Origin</dt>
          <dd><%= @journey.origin %></dd>

          <dt>Destination</dt>
          <dd><%= @journey.destination %></dd>

          <dt>Capacity</dt>
          <dd><%= @journey.capacity %></dd>

          <dt>Date</dt>
          <dd class='timestring'><%= @journey.date %></dd>

          <dt>Organizer</dt>
          <dd><%= @journey.organizer.email %></dd>

          <dt>Estimated price</dt>
          <dd><%= @uberx_price %></dd>
        </dl>

        <!-- Map -->
        <div id="map_canvas" style="width:100%; height:300px">
        </div>

        <script type="text/javascript" src="http://maps.google.com/maps/api/js?key=AIzaSyB3eG1Vt6y54OrKrHgpJnZb66QxQvy0kfM&sensor=false">
        </script>

        <script type="text/javascript">

        var directionDisplay;
        var directionsService = new google.maps.DirectionsService();
        var geocoder = new google.maps.Geocoder();
        var map;

        function initialize() {
          directionsDisplay = new google.maps.DirectionsRenderer();
          // set the default center of the map
          var latlng = new google.maps.LatLng(41.7891278,-87.5964067);

          // set route options (draggable means you can alter/drag the route in the map)
          var rendererOptions = { draggable: true };
          directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);

          // set the display options for the map
          var myOptions = {
            zoom: 14,
            center: latlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            mapTypeControl: false
          };

          // add the map to the map placeholder
          map = new google.maps.Map(document.getElementById("map_canvas"),myOptions);
          // bind the map to the directions
          directionsDisplay.setMap(map);
          // start the geolocation API
          if (navigator.geolocation) {
            // when geolocation is available on your device, run this function
            navigator.geolocation.getCurrentPosition(foundYou, notFound);
          } else {
            // when no geolocation is available, alert this message
            alert('Geolocation not supported or not enabled.');
          }
        };

        function notFound(msg) {
          alert('Could not find your location :(')
        };

        function calcRoute() {
          var start = "<%= @journey.origin %>";
          var end = "<%= @journey.destination %>";
          // compose a array with options for the directions/route request
          var request = {
            origin:start,
            destination:end,
            travelMode: 'DRIVING'
          };

          // call the directions API
          directionsService.route(request, function(response, status) {
            if (status == google.maps.DirectionsStatus.OK) {
              // directions returned by the API, clear the directions panel before adding new directions
              $('#directionsPanel').empty();
              // display the direction details in the container
              directionsDisplay.setDirections(response);
            } else {
              // alert an error message when the route could nog be calculated.
              if (status == 'ZERO_RESULTS') {
                alert('No route could be found between the origin and destination.');
              } else if (status == 'UNKNOWN_ERROR') {
                alert('A directions request could not be processed due to a server error. The request may succeed if you try again.');
              } else if (status == 'REQUEST_DENIED') {
                alert('This webpage is not allowed to use the directions service.');
              } else if (status == 'OVER_QUERY_LIMIT') {
                alert('The webpage has gone over the requests limit in too short a period of time.');
              } else if (status == 'NOT_FOUND') {
                alert('At least one of the origin, destination, or waypoints could not be geocoded.');
              } else if (status == 'INVALID_REQUEST') {
                alert('The DirectionsRequest provided was invalid.');
              } else {
                alert("There was an unknown error in your request. Requeststatus: nn"+status);
              }
            }
          });
        }
        </script>

      

        <!-- Buttons -->
        <% if @journey.organizer_id == current_user.id %>

        <div class="btn-group btn-group-justified">

          <div class="btn-group">
            <a href="/journeys" class="btn btn-primary">
              <i class="fa fa-chevron-left"></i>
            </a>
          </div>

          <div class="btn-group">
            <a href="/journeys/<%= @journey.id %>/edit" class="btn btn-warning">
              <i class="fa fa-edit"></i>
            </a>
          </div>

          <div class="btn-group">
            <a href="/delete_journey/<%= @journey.id %>" class="btn btn-danger" rel="nofollow">
              <i class="fa fa-trash-o"></i>
            </a>
          </div>

        </div>

        <% else %>

        <div class="btn-group btn-group-justified">

          <div class="btn-group">
            <a href="/journeys" class="btn btn-primary">
              <i class="fa fa-chevron-left"></i>
            </a>
          </div>

          <div class="btn-group">
            <form action="/create_seat" method="post">
              <!-- Hidden input for authenticity token to protect from forgery -->
              <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
              <!-- Label and input for journey_id -->
              <input type="hidden" name="journey_id" value="<%= @journey.id %>">
              <!-- Label and input for user_id -->
              <input type="hidden" name="user_id" value="<%= current_user.id %>">
              <!-- Button for form -->
              <button class="btn btn-success">
                Join
              </button>
            </form>
          </div>

        </div>

      </div>

    </div>

  </div>

  <% end %>

</div>
